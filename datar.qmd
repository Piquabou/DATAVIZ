# Cr√©er des graphiques avec R en utilisant `ggplot2`

**Faire des graphiques est un moyen puissant de transformer des donn√©es brutes en informations exploitables et de les communiquer de mani√®re efficace √† un public diversifi√©. Cela joue un r√¥le crucial dans la prise de d√©cision, la r√©solution de probl√®mes et la g√©n√©ration de nouvelles connaissances.**

## Barplot

Un barplot, ou diagramme √† barres, est un type de visualisation de donn√©es qui repr√©sente les donn√©es sous forme de barres rectangulaires. Chaque barre repr√©sente une cat√©gorie sp√©cifique, et la hauteur de la barre est proportionnelle √† une valeur num√©rique associ√©e √† cette cat√©gorie. 

```{r}
library(ggplot2)
```
```{r}
# Cr√©ation d'un data frame d'exemple
data <- data.frame(
  Cat√©gorie = c("A", "B", "C", "D", "E"),
  Valeur = c(20, 35, 15, 30, 25)
)

# Cr√©ation du barplot avec ggplot2
ggplot(data, aes(x = Cat√©gorie, y = Valeur)) +

# Barres bleues, hauteur = valeurs des donn√©es
geom_bar(stat = "identity", fill = "skyblue") +  

# Ajout de titres et √©tiquettes
labs(title = "Exemple de Barplot", x = "Cat√©gorie", y = "Valeur")
```

## Histogrammes

Un histogramme est utilis√© pour repr√©senter la distribution des valeurs d'une seule variable quantitative, en divisant la plage des valeurs en intervalles et en comptant le nombre d'observations dans chaque intervalle.

```{r}
# Cr√©ation d'un nouveau data.frame
data <- data.frame(
  Cat√©gorie = c("A", "B", "C", "D", "E"),
  Valeur = c(20, 35, 15, 30, 25)
)

# Chargement de la biblioth√®que n√©cessaire
library(ggplot2)

# Cr√©ation d'un diagramme √† barres pour visualiser la distribution des ventes mensuelles
ggplot(data, aes(x = Cat√©gorie, y = Valeur)) +

# Diagramme √† barres bleu avec bord noir
geom_col(fill = "skyblue", color = "black") +  

# Titres et √©tiquettes
labs(title = "Histogramme des ventes mensuelles", x = "Cat√©gorie", y = "Ventes")
```

## Scatterplot et Jitter

Un scatterplot, √©galement connu sous le nom de nuage de points, est une visualisation de donn√©es qui repr√©sente les valeurs de deux variables quantitatives sur un plan cart√©sien. Chaque point sur le graphique repr√©sente une paire de valeurs, une pour chaque variable. L'axe horizontal (axe des x) repr√©sente g√©n√©ralement une variable, tandis que l'axe vertical (axe des y) repr√©sente l'autre variable.

```{r}
# Cr√©ation de donn√©es d'exemple 

# (Pour la reproductibilit√©)
set.seed(123)

# Nombre de points
n <- 50

# Donn√©es pour l'axe x (distribution normale)
x <- rnorm(n, mean = 10, sd = 3)

# Donn√©es pour l'axe y (relation lin√©aire avec x + bruit)
y <- 2*x + rnorm(n, mean = 0, sd = 5)

# Cr√©ation d'un scatterplot pour visualiser la relation entre les variables x et y
plot(x, y, main = "Scatterplot avec Donn√©es Simul√©es", 

# Points bleus, ronds pleins
xlab = "X", ylab = "Y", col = "blue", pch = 16)  
```

## Boxplot

Un boxplot, √©galement connu sous le nom de bo√Æte √† moustaches, est un type de visualisation de donn√©es qui repr√©sente graphiquement la distribution des donn√©es et permet de visualiser la m√©diane, les quartiles et les valeurs aberrantes √©ventuelles d'un ensemble de donn√©es.

```{r}
# Cr√©ation d'un nouveau data.frame

# D√©finition des noms des produits
noms_produits <- c("Produit A", "Produit B", "Produit C", "Produit D", "Produit E")

# R√©p√©tition des mois pour chaque produit
mois <- rep(c("Janvier", "F√©vrier", "Mars", "Avril"), each = length(noms_produits))

# G√©n√©ration de valeurs de ventes al√©atoires pour chaque mois et produit
ventes <- round(runif(length(noms_produits) * length(unique(mois)), min = 100, max = 500))

# Cr√©ation du data.frame en combinant les trois vecteurs pr√©c√©dents
data2 <- data.frame(
  # Colonne 'Produit' avec r√©p√©tition des noms
  Produit = rep(noms_produits, times = length(unique(mois))),  
  # Colonne 'Mois' avec r√©p√©tition des mois
  Mois = mois,  
  # Colonne 'Ventes' avec les valeurs al√©atoires de ventes
  Ventes = ventes
  )

# Convertir la variable "Mois" en facteur avec un ordre sp√©cifique des niveaux
data2$Mois <- factor(data2$Mois, levels = c("Janvier", "F√©vrier", "Mars", "Avril"))

# Cr√©ation du boxplot avec ggplot2

# Boxplot avec coloration par mois
ggplot(data2, aes(x = Mois, y = Ventes, fill = Mois)) +
geom_boxplot() +

# Titres et l√©gendes
labs(title = "Boxplot des ventes mensuelles", x = "Mois", y = "Ventes", fill = "Mois") +  

# √âtiquettes de l'axe x inclin√©es
theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

```

## Lines

Un lines plot, √©galement appel√© line chart ou graphique lin√©aire, est une forme de visualisation de donn√©es qui repr√©sente la relation entre deux variables quantitatives en tra√ßant des points de donn√©es connect√©s par des lignes droites. Il est couramment utilis√© pour montrer l'√©volution ou les tendances des donn√©es sur une p√©riode de temps ou dans une s√©quence ordonn√©e.

```{r}
# Cr√©ation du lines plot avec ggplot2

# Lignes par produit
ggplot(data2, aes(x = Mois, y = Ventes, color = Produit, group = Produit)) +
geom_line() +

# Points pour marquer les donn√©es
geom_point(size = 3) +

# Titres et l√©gendes
labs(title = "Evolution des ventes mensuelles par produit", x = "Mois", y = "Ventes", 
color = "Produit") +

# √âtiquettes de l'axe x inclin√©es
theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Pieplot

Un pieplot, c'est un peu beaucoup inutile, et c'est moche en plus.

```{r}
# Charger les packages n√©cessaires
library(ggplot2)

# Cr√©er un dataframe avec vos donn√©es
# Ces valeurs repr√©sentent les pourcentages pour chaque cat√©gorie
donnees <- data.frame(
  categorie = c("Non", "Non en rouge"),
  valeur = c(80, 20)
)

# Cr√©er le pie plot
graphique_pie <- ggplot(donnees, aes(x = "", y = valeur, fill = categorie)) +

geom_bar(stat = "identity", width = 1) +
# Utiliser des coordonn√©es polaires pour le graphique en secteurs
coord_polar("y", start = 0) +

# Ajouter un titre
labs(title = "Faut-il faire des camenberts ?") +

# Couleur bleue pour "Non" et rouge pour "Non en rouge"
scale_fill_manual(values = c("#1f77b4", "red")) +

# Supprimer les axes et le fond
theme_void() +

# Placer la l√©gende √† droite du graphique
theme(legend.position = "right")

# Afficher le pie plot
print(graphique_pie)
```

# Personnaliser des graphiques

**Personnaliser des graphiques est une pratique courante pour rendre les visualisations de donn√©es plus attrayantes et informatives.**

**Voici quelques-unes des fa√ßons dont vous pouvez personnaliser des graphiques avec ggplot2 en R :**

## Changer les couleurs et les styles des √©l√©ments
<ul>
   <li>Utilisez les param√®tres `color` et `fill` dans `aes()` pour changer les couleurs des points, des lignes ou des barres.
   <li>Utilisez des √©chelles de couleurs personnalis√©es avec `scale_color_manual()` et `scale_fill_manual()` pour d√©finir des couleurs sp√©cifiques.
   <li>Utilisez les param√®tres `linetype`, `shape`, `size` pour modifier les styles des lignes, des points ou des barres.
</ul>

```{r}
library(ggplot2)

# Exemple de graphique √† points avec couleurs et styles personnalis√©s
data <- data.frame(
  Nom = c("Alice", "Bob", "Charlie", "David", "Emma"),
  Age = c(25, 30, 35, 40, 45),
  Salaire = c(50000, 60000, 70000, 80000, 90000)
)

# Cr√©ation d'un graphique en barres pour visualiser la relation entre l'√¢ge, le salaire 
# et l'individu

# D√©finit Age sur l'axe X, Salaire sur Y, color√© par Nom
ggplot(data, aes(x = Age, y = Salaire, fill = Nom)) +

# Affiche les barres s√©par√©es par Nom
geom_bar(stat = "identity", position = "dodge") +

# Couleurs personnalis√©es pour chaque Nom
scale_fill_manual(values = c("Alice" = "#EB9C64", "Bob" = "#FF8789", 
"Charlie" = "#8FBF9F", "David" = "#346145", "Emma" = "#554E4F"))
```

## Ajouter des titres et des √©tiquettes
<ul>
   <li>Utilisez la fonction `labs()` pour ajouter des titres aux axes x et y, ainsi qu'un titre au graphique.
   <li>Utilisez `theme()` pour ajuster l'apparence des titres et des √©tiquettes d'axe, par exemple en changeant la taille ou la police.
</ul>

```{r}
# Cr√©ation d'un graphique en barres avec Age en X et Salaire en Y, color√© par Nom
ggplot(data, aes(x = Age, y = Salaire, fill = Nom)) +

# Barres individuelles par Nom, repr√©sentant le Salaire
  geom_bar(stat = "identity", position = "dodge") +  

# Titre et √©tiquettes des axes
  labs(title = "Salaire en fonction de l'√¢ge", x = "√Çge (ans)", y = "Salaire (‚Ç¨)") +  

# Style des titres des axes
  theme(axis.title = element_text(size = 12, face = "bold"),  

# Style du titre principal
plot.title = element_text(size = 14, face = "bold"))  
```

## Personnaliser les axes
<ul>
  <li>Utilisez `scale_x_continuous()` ou `scale_y_continuous()` pour personnaliser les √©chelles des axes x et y, par exemple en d√©finissant les limites ou les √©tiquettes des graduations.
  <li>Utilisez `theme()` pour ajuster l'apparence des axes, par exemple en ajoutant des lignes de grille ou en modifiant les couleurs.
</ul>

```{r}
ggplot(data, aes(x = Age, y = Salaire, fill = Nom)) +
geom_bar(stat = "identity", position = "dodge") +  
# Utilise des barres s√©par√©es pour chaque Nom

# Limite l'axe X de 20 √† 50 ans avec des intervalles de 5 ans
scale_x_continuous(limits = c(20, 50), breaks = seq(20, 50, 5)) +

# Limite l'axe Y de 0 √† 100000 ‚Ç¨ avec des intervalles de 10000 ‚Ç¨
scale_y_continuous(limits = c(0, 100000), breaks = seq(0, 100000, 10000)) +

# Ajoute un titre et des √©tiquettes d'axe
labs(title = "Salaire en fonction de l'√¢ge", x = "√Çge (ans)", y = "Salaire (‚Ç¨)") +

# Personnalise les lignes des axes
theme(axis.line = element_line(color = "black", linewidth = 0.5),

# Personnalise les lignes de grille principales
panel.grid.major = element_line(color = "gray", linewidth = 0.5))
```

## Modifier les l√©gendes
<ul>
  <li>Utilisez `guides()` pour modifier l'apparence des l√©gendes, par exemple en ajustant la position ou en d√©sactivant une l√©gende sp√©cifique.
  <li>Utilisez `labs()` pour renommer les l√©gendes ou changer leur titre.
</ul>

```{r}
ggplot(data, aes(x = Age, y = Salaire, fill = Nom)) +

# Barres pour chaque personne, s√©par√©es par √¢ge
geom_bar(stat = "identity", position = "dodge") +

# Ajout de titres et √©tiquettes d'axe
labs(title = "Salaire en fonction de l'√¢ge", x = "√Çge (ans)", y = "Salaire (‚Ç¨)") +

# Ajout d'une l√©gende avec titre pour les couleurs
guides(fill = guide_legend(title = "Nom"))
```

On constate donc qu'il faut s'appeller Emma pour gagner beaucoup d'argent.

# Cr√©er un graphique multipanneaux

**Les graphiques multipanneaux sont utiles pour comparer plusieurs s√©ries de donn√©es ou pour visualiser les donn√©es en fonction de plusieurs variables cat√©gorielles.**

```{r}
# Cr√©ation d'un jeu de donn√©es fictif pour les ventes de produits par r√©gion et par mois
set.seed(123)  # Pour la reproductibilit√©

# R√©gions
regions <- c("Nord", "Sud", "Est", "Ouest")

# Produits
produits <- c("Salade", "Tomate", "Oignon", "Samourai")

# Mois
mois <- c("Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", 
"Septembre", "Octobre", "Novembre", "D√©cembre")

# G√©n√©rer des donn√©es de ventes al√©atoires
donnees_ventes <- data.frame(region = rep(regions, each = length(produits) * 
                              length(mois)),
                              produit = rep(produits, times = length(regions) * 
                              length(mois)),
                              mois = rep(mois, each = length(produits), 
                              times = length(regions)),
                              ventes = round(runif(length(regions) * length(produits) * 
                              length(mois), min = 100, max = 1000)))
```
```{r}
# Charger les packages n√©cessaires
library(ggplot2)

# D√©finir une palette de couleurs
palette_couleurs <- c("#FF9999", "#66CCCC", "#FFCC66", "#99CC99")

donnees_ventes$mois <- factor(donnees_ventes$mois, levels = c("Janvier", "F√©vrier", 
"Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", 
"D√©cembre"))

# Cr√©er le graphique multipanneaux avec une pr√©sentation plus esth√©tique
graphique <- ggplot(donnees_ventes, aes(x = mois, y = ventes, fill = produit)) +

# Barres plus fines
geom_bar(stat = "identity", position = "stack", color = "white", width = 0.7) +

# Diviser le graphique en panneaux en fonction des r√©gions
facet_wrap(~ region, scales = "free", nrow = 2) +

# Utiliser la palette de couleurs d√©finie
scale_fill_manual(values = palette_couleurs) +

labs(title = "Ventes mensuelles par r√©gion et par produit", x = "Mois", y = "Ventes") +

# Utiliser un th√®me minimal pour le graphique
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1),

# Placer la l√©gende en bas
legend.position = "bottom",

# Supprimer le titre de la l√©gende
legend.title = element_blank(),

# Mettre la l√©gende dans une bo√Æte horizontale
legend.box = "horizontal",

# Espacement entre les panneaux
panel.spacing = unit(1, "lines"),

# Supprimer le fond des panneaux
strip.background = element_blank(),

# Texte en gras pour les titres des panneaux
strip.text = element_text(face = "bold"))

# Afficher le graphique
print(graphique)
```

# Cr√©er une carte

Les "maps" sur R font r√©f√©rence √† la repr√©sentation graphique de donn√©es g√©ographiques sous forme de cartes. Elles sont utilis√©es pour visualiser des donn√©es spatiales, telles que des donn√©es d√©mographiques, des donn√©es m√©t√©orologiques, des donn√©es environnementales, etc. Les cartes sont particuli√®rement utiles pour visualiser des informations qui varient dans l'espace et pour identifier des tendances ou des mod√®les g√©ographiques. üó∫Ô∏è

## Installation des packages n√©cessaires
```{r, include=FALSE}
library(leaflet)
library(tidyverse)
```

## Cr√©er une carte avec un marqueur sur Toulouse
```{r}
# Construction d'une carte interactive
map <- leaflet() %>% 

# Ajout de tuiles de carte par d√©faut (OpenStreetMap)
addTiles() %>%

# Ajout d'un marqueur √† Toulouse avec un popup
addMarkers(lng = 1.43, lat = 43.6, popup = "Ce marqueur est plac√© √† Toulouse")

# Affiche la carte
map
```

## Cr√©er un dataframe pour ajouter des marqueurs suppl√©mentaires

```{r}
# Cr√©ation d'un data.frame avec des donn√©es de localisation pour Toulouse
dataToulouse <- data.frame(
  lng = c(1.431889991011, 1.448399993334, 1.447109657227),  # Longitudes des lieux
  lat = c(43.609126998861, 43.606276020224, 43.604503567579),  # Latitudes des lieux
  label = c("The Botanist Pub", "IA School", "Jardin Pierre Goudouli")  # Noms des lieux
)
```

## Affichage de la carte avec le code en int√©gralit√©
```{r}
dataToulouse <- data.frame(
  lng = c(1.431889991011, 1.448399993334, 1.447109657227),
  lat = c(43.609126998861, 43.606276020224, 43.604503567579),
  label = c("The Botanist Pub", "IA School", "Jardin Pierre Goudouli")
)

# Initialisation d'une carte interactive avec des donn√©es sp√©cifiques √† Toulouse
map_Toulouse <- leaflet(dataToulouse) %>% 

# Ajout des tuiles par d√©faut d'OpenStreetMap
addTiles() %>%

# Ajout de marqueurs sur la carte avec des popups pour chaque lieu
addMarkers(~lng, ~lat, popup = ~label) %>%

# Utilisation de tuiles Stamen Toner Lite pour un style de carte diff√©rent
addProviderTiles(providers$Stamen.TonerLite)

# Affichage de la carte
map_Toulouse
```

<br>

Maintenant que vous savez cr√©er des graphiques avec R, passons aux <a href=exercices_r.qmd class="bouton">exercices !</a>
